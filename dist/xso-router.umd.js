(function(f,o){typeof exports=="object"&&typeof module<"u"?o(exports):typeof define=="function"&&define.amd?define(["exports"],o):(f=typeof globalThis<"u"?globalThis:f||self,o(f.router={}))})(this,function(f){"use strict";function o(t,e,n,s){if(o.null==e)throw new Error(`${n} is null and not a valid ${t}.`);if(o.invalid==e)throw new Error(`${n} is ${typeof s} and not a valid ${t}.`)}o.array="array",o.function="function",o.object="object",o.string="string",o.null=0,o.invalid=1;function J(t,e){e==null&&o(o.array,o.null,t,e),(typeof e!="object"||!Array.isArray(e))&&o(o.array,o.invalid,t,e)}function k(t,e){e==null&&o(o.function,o.null,t,e),typeof e!="function"&&o(o.function,o.invalid,t,e)}function y(t,e){e==null&&o(o.object,o.null,t,e),(typeof e!="object"||Array.isArray(e))&&o(o.object,o.invalid,t,e)}function O(t,e){e==null&&o(o.string,o.null,t,e),typeof e!="string"&&!(e instanceof String)&&o(o.string,o.invalid,t,e)}function g(t){return typeof t=="object"&&t!=null&&Array.isArray(t)}function X(t){return typeof t=="function"&&t!=null}function S(t){return typeof t=="object"&&t!=null&&!Array.isArray(t)}function j(t){return(typeof t=="string"||t instanceof String)&&t!=null}const $=[],x="_xso_com_",p={COMPONENTS:$,COMPONENTS_PREFIX:x,getComponent:t=>{const e=$.find(n=>n.key==t);return e?e.instance:null},isKey:t=>t.indexOf(x)==0};class b{#s=null;#e=null;#i=null;#t=null;constructor(e,n){this.#s=e,this.#e=n}get current(){return this.#t}set current(e){this.#t=e,this.#e.fire(this)}set(e){return this.#i=e,this}get(){return this.#i}}b.prototype.toString=function(){return this.current};function E(t,e,n,s){y("Properties",e);for(const r of Object.keys(e)){const i=e[r];if(r==="_"&&i)g(i)?m(t,i,n,!1,s):S(i)?m(t,[i],n,!1,s):t.textContent=i;else if(r==="$"&&i)g(i)?m(t,i,n,!0,s):S(i)?m(t,[i],n,!0,s):t.innerHTML=i;else if(r==="text"&&i)O(r,i),t.innerText=i;else if(r==="html"&&i)O(r,i),t.innerHTML=i;else if(r==="style"&&i){y(r,i);for(const l of Object.keys(i))l.indexOf("--")===0?t.style.setProperty(l,i[l]):t.style[l]=i[l]}else if(r==="className"&&i)O(r,i),t.className instanceof SVGAnimatedString?t.className.baseVal=i:t.className=i;else if(r==="classList"&&i)t.className instanceof SVGAnimatedString?t.className.baseVal=i.join(" "):M(r,t,i);else if(r==="class"&&i){if(j(i))t.className instanceof SVGAnimatedString?t.className.baseVal=i:t.className=i;else if(g(i))M(r,t,i);else if(i!=null)throw new Error(`CSS Class of type ${typeof i} is not valid, only string or array of strings is accepted.`)}else r.indexOf("on")===0?i&&(k(r,i),t.addEventListener(r.substring(2).toLowerCase(),i)):i!=null&&t.setAttribute(r,i)}}function M(t,e,n){J(t,n);for(const s of n)O(t,s),e.classList.add(s)}function m(t,e,n,s=!1,r){const i=[];if(S(e))if(e instanceof b){const l=m(t,e.get(),n);if(l.length===0)throw new Error("Reference is empty with no valid elements.");if(l.length>1)throw new Error("Reference with more than 1 element.");e.current=l[0]}else{const l=Object.keys(e);if(l.length>1)throw new Error(`Object with more than 1 keys: ${l.join(", ")}`);if(l.length===0)throw new Error("Object with no key, but one is required.");for(const a of l){const c=e[a];if(p.isKey(a)){let u=p.getComponent(a);if(u)u=u.clone(),u.parent=t,u.render(c),n&&n.appendChildComponent(u),i.push(u);else{const C=document.createElement("xso-com-error");C.innerText="# XSO Component Error #",t.appendChild(C)}}else if(a==="svg"&&!c.xmlns&&!r&&(r="http://www.w3.org/2000/svg"),c.xmlns){const u=document.createElementNS(c.xmlns,a);E(u,c,n,c.xmlns),i.push(u),t.appendChild(u)}else if(r){const u=document.createElementNS(r,a);E(u,c,n,r),i.push(u),t.appendChild(u)}else{const u=document.createElement(a);E(u,c,n),i.push(u),t.appendChild(u)}}}else if(g(e))for(const l of e)if(j(l))if(s){const a=document.createElement("span");a.innerHTML=l,t.appendChild(a),i.push(l)}else{const a=document.createTextNode(l);t.appendChild(a),i.push(l)}else m(t,l,n,!1,r);else if(e!=null)throw new Error(`View of type ${typeof e} is invalid, only object or array of objects.`);return i}class A{#s=null;#e=null;#i=null;#t=null;constructor(e,n){this.#s=e,this.#i=n}set val(e){JSON.stringify(this.#t)!==JSON.stringify(e)&&(this.#e=this.#i,this.#i=e,this.#t=JSON.stringify(e))}get val(){return this.#i}get previous(){return this.#e}}A.prototype.toString=function(){return this.val};class R{#s=null;#e=null;#i=null;#t=null;#o=0;constructor(e,n,s){this.#s=e,this.#e=n,this.#t=s}set $val(e){this.#t!==e&&(this.#r(e),this.#s.render(),this.#e.fire(this))}get $val(){return this.#t}set val(e){this.#t!==e&&(this.#r(e),this.#e.fire(this))}get val(){return this.#t}get previous(){return this.#i}get lastChanged(){return this.#o}#r(e){this.#i=this.#t,this.#t=e,this.#o=Date.now()}}R.prototype.toString=function(){return this.val};class q{#s=[];#e=[];add(e,n){this.#s.push({items:e,func:n})}fire(e){const n=this.#s.filter(s=>s.items.includes(e));for(const s of n)s&&!this.#e.includes(s.func)&&(this.#e.push(s.func),setTimeout(()=>{this.#e.splice(this.#e.indexOf(s.func),1),s.func()},0))}}function L(t){return t instanceof d}function N(t){if(!L(t))throw new Error("Invalid component, because not implement the component class.")}class d{#s=!1;#e=null;#i=null;#t=null;#o=null;#r=null;#h=[];#l=()=>{};#c=()=>{};#f=()=>{};#n={elements:[],components:[]};#a=new q;parent=null;#u=null;constructor(e,n){if(!X(e)||e.toString().indexOf("function")!=0)throw new Error("Only classic functions are used for components and arrow function is not supported.");this.#e=e,this.#i=n,this.#d()}#d(){for(;;){const e=p.COMPONENTS_PREFIX+"["+this.name()+"]_"+(Math.random()+1).toString(36).substring(2);if(!p.COMPONENTS.find(n=>n.key==e)){this.#t=e;break}}p.COMPONENTS.push({key:this.#t,instance:this})}name(){return this.#e.name}clone(){return new d(this.#e,this.#i)}logErrorStack(){window.setTimeout(()=>console.error(this.name()+" >> Component"+this.#i),0)}childrenElements(){return[...this.#n.elements]}childrenComponents(){return[...this.#n.components]}appendChildComponent(e){N(e),this.#n.components.push(e)}#m(){if(this.#n.elements.length>0){if(parent=this.#n.elements[0].parentNode,parent==null)return;for(const e of this.#n.elements)parent.contains(e)&&parent.removeChild(e)}}#y(){for(const e of this.#n.components)e.unmount();this.#n.components=[]}mount(e){e?this.#l=e:this.#l()}unmount(e){e?this.#c=e:(this.#y(),this.#m(),this.#c())}view(e){this.#f=e}ref(){return new b(this,this.#a)}changes(e,n){this.#a.add(e,n)}render(e){try{const n=this;this.#o?(this.#u&&clearTimeout(this.#u),this.#u=setTimeout(()=>{n.#p(e)},0)):n.#p(e)}catch(n){throw this.logErrorStack(),n}}#p(e){this.#o?e?this.#o.val=e:this.#r={state:0}:this.#o=new A(this,e),this.#s==!1&&this.#e.bind(this)(this.#o.val);let n=this.#f.bind(this)();(!n||n.length==0)&&(n=[{span:{style:{display:"none"}}}]);let s=null;this.#r&&(s=this.#n.elements[0].parentNode);const r=document.createDocumentFragment(),i=this.#n.components;if(this.#n.components=[],m(r,n,this),this.#r){const l=[];for(const a of r.children)l.push(a);if(this.#n.elements.length==0)this.parent.appendChild(r);else{s.insertBefore(r,this.#n.elements[0]);for(const a of i)a.unmount();for(const a of this.#n.elements)s.contains(a)&&s.removeChild(a)}this.#n.elements=l}else{for(const l of r.children)this.#n.elements.push(l);this.parent.appendChild(r)}this.#r=null,this.#s==!1&&(this.#s=!0,this.#l&&window.setTimeout(this.#l,0))}static isSameType(e,n){let s=null;for(const i of Object.keys(e))s=i;return p.getComponent(s).#e===n.#e}function(){return this.#e}key(){return this.#t}destroy(){const e=p.COMPONENTS.findIndex(n=>n.key==this.#t);p.COMPONENTS.splice(e,1)}state(e){if(this.#r)return this.#h[this.#r.state++];const n=new R(this,this.#a,e);return this.#h.push(n),n}}d.prototype.toString=function(){return this.key()};function G(t){y("Component Props",t);let e=null;for(const n of Object.keys(t)){if(e!=null)throw new Error(`More than 1 component in the same object: ${t}`);e=t[n],y("Component Props Loaded",e)}return e}function _(t){y("jsonDefinition of an invalid object.",t);let e=null;for(const s of Object.keys(t))e=s;let n=e;return e.indexOf(p.COMPONENTS_PREFIX)==0&&(n=e.substring(e.indexOf("[")+1,e.lastIndexOf("]"))),JSON.stringify({[n]:t[e]})}function v(t,e){const n=s=>new Error(`Only ${e.function().name} type is accepted! This component is invalid: ${_(s)}`);if(g(t)){for(const s of t)if(y("ensureSameKind of an invalid object.",s),!d.isSameType(s,e))throw n(s)}else if(S(t)){if(!d.isSameType(t,e))throw n(t)}else throw new Error("Invalid kind.")}v.required=(t,e)=>{if(t)return v(t,e);throw new Error(`${e.name()} is required.`)},v.optional=(t,e)=>{t&&v(t,e)};function h(t){return k("Component",t),new d(t,new Error().stack)}h.create=(t,e,n)=>{N(e),e.parent=t,e.render(n)},h.ensure=N,h.is=L,h.isSameType=d.isSameType,h.ensureType=v,h.props=G,h.json=_;function H({path:t,component:e}){const n=this.state(!1),s=this.state(null);this.updatePath=r=>{const i=r.split("/"),l=t.split("/");let a=i.length==l.length;if(a){s.val={};for(const[c,u]of l.entries()){const C=i[c];let T=u.indexOf("{"),P=u.indexOf("}");if(T==0&&T+1<P&&P==u.length-1)s.val[u.substring(T+1,P)]=C;else if(u!=C){a=!1;break}}if(a){n.$val=!0;return}}s.val={},n.$val=!1},this.view(()=>n.val?[{[e]:{route:{params:s.val}}}]:[])}const I=h(H);let D=null,F="/";const w=h(function({routes:e}){h.ensureType(e,I),D=this;const n=e.map(()=>this.ref());this.updatePath=s=>{for(const r of n)r.current.updatePath(s)},this.view(()=>{const s=[];for(const[r,i]of e.entries())s.push(n[r].set(i));return s})});w.updatePath=t=>{F=t,D.updatePath(t)},w.currentPath=()=>F,window.addEventListener("load",function(t){const e=window.location.pathname;w.updatePath(e)}),window.addEventListener("popstate",function(t){const e=window.location.pathname;w.updatePath(e)});function z(t){const{to:e,top:n,onClick:s}=t,r={...t};delete r.to,delete r.top,delete r.onClick,this.view(()=>[{a:{href:e||"#",onClick:i=>{i.preventDefault();let l=e,a=null;return e.indexOf("#")>=0&&(l=e.substring(0,e.indexOf("#")),a=e.substring(e.indexOf("#")+1)),K(l),a&&window.setTimeout(()=>location.hash="#"+a,0),n!==!1&&window.scrollTo(0,0),s&&s(),!1},...r}}])}const B=h(z);function K(t){history.pushState(null,null,t),w.updatePath(t)}f.Navigate=B,f.Route=I,f.Router=w,f.navigateTo=K,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
